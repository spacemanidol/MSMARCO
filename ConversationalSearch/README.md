# Conversational Search
Truly Conversational Search is the next logic step in the journey to generate intelligent and useful AI. To understand what this may mean, researchers have voiced a continuous desire to study how people currently converse with search engines. Traditionally, the desire to produce such a comprehensive dataset has been limited because those who have this data (Search Engines) have a responsibility to their users to maintain their privacy and cannot share the data publicly in a way that upholds the trusts users have in the Search Engines. Given these two powerful forces we believe we have a dataset and paradigm that meets both sets of needs: A artificial public dataset that approximates the true data and an ability to evaluate model performance on the real user behavior. What this means is we released a public dataset which is generated by creating artificial sessions using embedding similarity and will test on the original data. To say this again: we are not releasing any private user data but are releasing what we believe to be a good representation of true user interactions.

We will release the full dataset shortly but while we are formulating the challange and usage we would appreciate feedback from the research community on how we should go ahead and filter these 18m sessions to be optimally usable. This initial public release includes 2 sets of 500,000 artificial sessions, one for each embedding method. 

## Corpus Generation
To generate our projection corpus, we took the 1,010,916 MSMARCO queries and added the 537,336 queries availible in the Quora Duplicate question dataset to create a corpus of ~1.5m unique queries. For each of these queries we generated both Bing specific and BERT based query embeddings. Once we had these embedding spaces, we build an Approximate Nearest Neighbor Index using [ANNOY](https://github.com/spotify/annoy).
Next, we sampled our Bing usage log from 2018-06-01 to 2018-11-30 to find a sample of sessions that that had more than 1 query and were likely to be conversational in nature. Next we remove all navigation, bot, junk, and adult sessions. Once we did this, we now had 18,986,870 unique user sessions of 344,147 unique queries. The average session was 2.6 queries long and the longest session was 160 queries. Just like we did for our public queries, we generated 2 embedding for each unique query. Finally, in order to merge the two, for each unique session we perform a nearest neighbor lookup in vector space. This allows us to join the public queries to the private sessions generating an artificial user session grounded in true user behavior. 

We will release the full dataset shortly but while we are formulating the Challange and usage we would appreciate feedback from the research community on how we should go ahead and filter these 18m sessions to be optimally usable. This initial public release includes 2 sets of 500,000 artificial sessions, one for each embedding method. 


### Process
1. Downloaded the data
~~~
./downloadData.sh
~~~
2. Generate the querySets
~~~
python generateQuerySets.py <msmarco train queries> <msmarco dev queries> <msmarco eval queries> <quoraQueries> <NQFolder>
~~~
3. Get Query Embeddings
~~~
python generateQueryEmbeddings.py <url> allQueries.tsv queryEmbeddings.tsv
~~~
4. Generate BERT Query Embeddings
To generate our Query Embeddings [we used BERT As A Service](https://github.com/hanxiao/bert-as-service) to generate a unique query embedding for each query in our set. If you want to go ahead and regenerate embeddings(or use it to generate another alternate query source for you model) you can follow what we did below.
~~~
cd Data/BERT
pip install bert-serving-server  # server
pip install bert-serving-client  # client, independent of `bert-serving-server`
wget https://storage.googleapis.com/bert_models/2018_10_18/cased_L-24_H-1024_A-16.zip
unzip cased_L-24_H-1024_A-16
bert-serving-start -model_dir ~/Data/BERT/cased_L-24_H-1024_A-16  -num_worker=4 -device_map 0 #depending on your computer play around with these settings
~~~
In a separate shell
~~~
python3 generateQueryEmbeddingsBERT.py allQueries.tsv BERTQueryEmbeddings.tsv
~~~
5. Generate Sessions
~~~
python generateArtificialSessions.py realQueries queryEmbeddings.tsv BERTQueryEmbeddings.tsv queryEmbeddings.ann sessions.tsv
~~~
